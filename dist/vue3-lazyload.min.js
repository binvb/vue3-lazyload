/*!
 * Vue3-Lazyload.js v0.2.2-beta
 * A Vue3.x image lazyload plugin
 * (c) 2020 MuRong <admin@imuboy.cn>
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).VueLazyload=t()}(this,function(){"use strict";var i,e;(e=i=i||{}).LOADING="loading",e.LOADED="loaded",e.ERROR="error";var t="undefined"!=typeof window&&null!==window,s=function(){if(t&&"IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype)return"isIntersecting"in window.IntersectionObserverEntry.prototype||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return 0<this.intersectionRatio}}),!0;return!1}(),a=Object.prototype.propertyIsEnumerable,u=Object.getOwnPropertySymbols;function f(e){return"function"==typeof e||"[object Object]"===toString.call(e)}function p(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];var r,n,i=0;for(("object"==typeof(r=e)?null===r:"function"!=typeof r)&&(e=t[i++]),e=e||{};i<t.length;i++)if(f(t[i])){for(var s=0,c=Object.keys(t[i]);s<c.length;s++){var l=c[s];"__proto__"!==(n=l)&&"constructor"!==n&&"prototype"!==n&&(f(e[l])&&f(t[i][l])?p(e[l],t[i][l]):e[l]=t[i][l])}!function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];if(!f(e))throw new TypeError("expected the first argument to be an object");if(0===t.length||"function"!=typeof Symbol||"function"!=typeof u)return;for(var r=0,n=t;r<n.length;r++)for(var i=n[r],s=0,c=u(i);s<c.length;s++){var l=c[s];a.call(i,l)&&(e[l]=i[l])}}(e,t[i])}return e}var o={rootMargin:"0px",threshold:0},c="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",r=(n.prototype.config=function(e){void 0===e&&(e={}),p(this.options,e)},n.prototype.mount=function(e,t){this._image=e;var o=this._valueFormatter(t.value),r=o.src,n=o.loading,t=o.error,o=o.lifecycle;this._lifecycle(i.LOADING,o),this._image.setAttribute("src",n||c),s||(this.loadImages(e,r,t,o),this._log(function(){throw new Error("Not support IntersectionObserver!")})),this._initIntersectionObserver(e,r,t,o)},n.prototype.update=function(e,t){this._observer.unobserve(e);var o=this._valueFormatter(t.value),r=o.src,t=o.error,o=o.lifecycle;this._initIntersectionObserver(e,r,t,o)},n.prototype.unmount=function(e){this._observer.unobserve(e)},n.prototype.loadImages=function(e,t,o,r){this._setImageSrc(e,t,o,r)},n.prototype._setImageSrc=function(e,t,o,r){var n=this;"img"===e.tagName.toLowerCase()?(t&&e.setAttribute("src",t),this._listenImageStatus(e,function(){n._log(function(){console.log("Image loaded successfully!")}),n._lifecycle(i.LOADED,r)},function(){e.onload=null,n._lifecycle(i.ERROR,r),n._observer.disconnect(),o&&e.setAttribute("src",o),n._log(function(){throw new Error("Image failed to load!")})})):e.style.backgroundImage="url('"+t+"')"},n.prototype._initIntersectionObserver=function(t,o,r,n){var i=this,e=this.options.observerOptions;this._observer=new IntersectionObserver(function(e){Array.prototype.forEach.call(e,function(e){e.isIntersecting&&(i._observer.unobserve(e.target),i._setImageSrc(t,o,r,n))})},e),this._observer.observe(this._image)},n.prototype._listenImageStatus=function(e,t,o){e.onload=t,e.onerror=o},n.prototype._valueFormatter=function(e){var t=e,o=this.options.loading,r=this.options.error,n=this.options.lifecycle;return f(e)&&(t=e.src,o=e.loading||this.options.loading,r=e.error||this.options.error,n=e.lifecycle||this.options.lifecycle),{src:t,loading:o,error:r,lifecycle:n}},n.prototype._log=function(e){this.options.log&&e()},n.prototype._lifecycle=function(e,t){switch(e){case i.LOADING:this._image.setAttribute("lazy",i.LOADING),null!=t&&t.loading&&t.loading();break;case i.LOADED:this._image.setAttribute("lazy",i.LOADED),null!=t&&t.loaded&&t.loaded();break;case i.ERROR:this._image.setAttribute("lazy",i.ERROR),null!=t&&t.error&&t.error()}},n);function n(e){this.options={loading:c,error:"",observerOptions:o,log:!0,lifecycle:{}},this.config(e)}return{install:function(e,t){t=new r(t);e.config.globalProperties.$Lazyload=t,e.provide("Lazyload",t),e.directive("lazy",{mounted:t.mount.bind(t),updated:t.update.bind(t),unmounted:t.unmount.bind(t)})}}});
